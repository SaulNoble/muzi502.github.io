<!DOCTYPE html>
<html class="theme-next gemini" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2" , user-scalable="no/">
<meta name="theme-color" content="#222">
    <link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">
<link rel="stylesheet" href="/css/main.css?v=7.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=7.1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=7.1.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=7.1.0">
  <link rel="mask-icon" href="/favicon.ico?v=7.1.0" color="#222">
<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"always","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: "",
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>
  <meta name="description" content="TLD:DR过去的 30 多年中，自由软件基金会 （Free Software Foundation 简称 FSF ）和电子前线基金会 (Electronic Frontier Foundation 简称 EFF）一直是无政府主义（Anarchy）对抗 BIG BROTHER 的最前线，这种对抗不仅仅是在技术领域，法律领域也是如此。FSF 倡导了三十多年的自由软件运动对抗商业公司的私有软件以及 E">
<meta property="og:type" content="website">
<meta property="og:title" content="电子前哨基金会 2019 年回顾">
<meta property="og:url" content="https://blog.502.li/source/draft/2019-12-30-eff-2019-review.html">
<meta property="og:site_name" content="木子">
<meta property="og:description" content="TLD:DR过去的 30 多年中，自由软件基金会 （Free Software Foundation 简称 FSF ）和电子前线基金会 (Electronic Frontier Foundation 简称 EFF）一直是无政府主义（Anarchy）对抗 BIG BROTHER 的最前线，这种对抗不仅仅是在技术领域，法律领域也是如此。FSF 倡导了三十多年的自由软件运动对抗商业公司的私有软件以及 E">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-31T13:05:21.367Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="电子前哨基金会 2019 年回顾">
<meta name="twitter:description" content="TLD:DR过去的 30 多年中，自由软件基金会 （Free Software Foundation 简称 FSF ）和电子前线基金会 (Electronic Frontier Foundation 简称 EFF）一直是无政府主义（Anarchy）对抗 BIG BROTHER 的最前线，这种对抗不仅仅是在技术领域，法律领域也是如此。FSF 倡导了三十多年的自由软件运动对抗商业公司的私有软件以及 E">
  <link rel="alternate" href="/atom.xml" title="木子" type="application/atom+xml">
  <link rel="canonical" href="https://blog.502.li/source/draft/2019-12-30-eff-2019-review">
<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>电子前哨基金会 2019 年回顾 | 木子</title>
  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }
  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">木子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">时光痕迹</h1>
  </div>
  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>
<nav class="site-nav">
    <ul id="menu" class="menu">
          <li class="menu-item menu-item-home">
    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-desktop"></i> <br>首页</a>
  </li>
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
          <li class="menu-item menu-item-书单">
    <a href="/booklist.html" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>书单</a>
  </li>
          <li class="menu-item menu-item-友链">
    <a href="/link/" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i> <br>友链</a>
  </li>
          <li class="menu-item menu-item-about">
    <a href="/about.html" rel="section"><i class="menu-item-icon fa fa-fw fa-user-circle-o"></i> <br>关于</a>
  </li>
        <li class="menu-item menu-item-search">
            <a href="javascript:;" class="popup-trigger">
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
    </ul>
    <div class="site-search">
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>
    </div>
</nav>
</div>
    </header>
    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
  <div id="posts" class="posts-expand">
    <div class="post-block page">
      <header class="post-header">
<h2 class="post-title" itemprop="name headline">电子前哨基金会 2019 年回顾
</h2>
<div class="post-meta">
  <ul class="breadcrumb">
            <li><a href="/source/">SOURCE</a></li>
            <li><a href="/source/draft/">DRAFT</a></li>
            <li>2019-12-30-EFF-2019-REVIEW</li>
  </ul>
</div>
</header>
      <div class="post-body">
          <h2 id="TLD-DR"><a href="#TLD-DR" class="headerlink" title="TLD:DR"></a>TLD:DR</h2><p>过去的 30 多年中，自由软件基金会 （Free Software Foundation 简称 FSF ）和电子前线基金会 (Electronic Frontier Foundation 简称 EFF）一直是无政府主义（Anarchy）对抗 BIG BROTHER 的最前线，这种对抗不仅仅是在技术领域，法律领域也是如此。FSF 倡导了三十多年的自由软件运动对抗商业公司的私有软件以及 EFF 在从成立那一天起就一直与危害互联网自由的法案作立法斗争。</p>
<p>今天翻译 EFF 官网的一篇文章 </p>
<h2 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h2><ul>
<li><a href="https://www.eff.org/deeplinks/2019/12/2019-review" target="_blank" rel="noopener">2019 in Review</a></li>
</ul>
<h2 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h2><blockquote>
<p>  In November’s landmark opinion in <em>Alasaad v. McAleenan</em>, a federal judge ruled that suspicionless electronic device searches at U.S. ports of entry violate the Fourth Amendment. The <em>Alasaad</em> opinion was the perfect way to end 2019—the culmination of two years of hard work by EFF, ACLU, and our 11 clients. In another sense, it was a culmination of our decades of work explaining to the public and the courts that you don’t lose your rights when you go online or use digital tools.</p>
</blockquote>
<p>在 11 月标志性的 <code>Alasaad v. McAleenan</code> 案中，一位联邦法官裁定，联邦特工在美国入境口岸对旅客的电子设备进行毫无怀疑的搜索违反了《第四修正案》。Alasaad 的认为这是 2019 年美好的结尾，这是EFF（电子前哨基金会），ACLU（美国公民自由联盟） 和我们 11 个客户两年努力付出的胜利告终。从另一种意义上来说，向公众和法院解释了您上网或使用数字设备时不会失去你的权力，这也是我们数十年来工作的结晶。</p>
<blockquote>
<p>  <strong>Every time policymakers or private companies tried to undermine your rights online, we were there.</strong></p>
</blockquote>
<p><strong>每当决策者或私有企业试图侵害你的网络权力时，我们都会与你站在一起。</strong></p>
<blockquote>
<p>  Looking back over 2019, there were so many moments when powerful forces tried to bargain away our digital rights. Both in the U.S. and around the world, authorities used increasingly sneaky word games to undermine our right to secure, private communications. They used new terminology like “ghost” and “client-side scanning” to obscure the fact that they were simply pushing to undermine end-to-end encryption, just as they have been trying to do for 20 years.</p>
</blockquote>
<p>回顾 2019 年，强权多次试图侵犯我们的网络权力。在美国及世界各地，当局不断地使用卑鄙的文字游戏来破坏我们保护私密通信的权利。他们使用诸如“幽灵”和“客户端扫描”之类的新术语来掩盖他们试图破坏端到端加密，就像他们已经尝试了 20 年一样。</p>
<blockquote>
<p>  Some members of Congress tried to create a “small-claims court” for copyright infringement online. That might sound reasonable until you realize that it would put ordinary Internet users on the hook for $30,000 for common activities like sharing memes and videos online. Others attempted to dismantle Section 230, the essential law protecting your ability to speak online. Others tried to undermine <em>Alice v. CLS Bank</em>, the Supreme Court opinion that protects innovators online by taking dangerous, broad software patents out of the hands of patent trolls.</p>
</blockquote>
<p>一些国会议员试图为网络侵权建立一个“小额诉讼法院”。这听起来可能很合理，但你会意识到，这会让普通的互联网用户因在线分享表情包和视频等常见活动支付 3 万美元。其他人则试图取消第230节，这是保护您在线发言能力的基本法律。其他人则试图破坏最高法院的Alice诉CLS银行的意见，该意见通过从专利巨魔手中夺走危险的广泛软件专利来保护在线创新者。</p>
<blockquote>
<p>  But every time policymakers or private companies tried to undermine your rights online, we were there. EFF stood before Congress this year to defend Section 230 and also to explain why limits on software patents protect small businesses. Here in California, we defended the groundbreaking California Consumer Privacy Act against numerous attempts by powerful Internet companies to weaken its protections for Internet users. Across the country, we helped communities stand up and pass bans on police use of facial recognition.</p>
</blockquote>
<p>但是，每当决策者或私人公司试图在网上破坏您的权利时，我们就在那里。EFF今年在国会上为第230条辩护，并解释了为什么软件专利限制可以保护小型企业。在加利福尼亚州，我们为功能强大的互联网公司为削弱对互联网用户的保护而进行的众多尝试而为具有突破性意义的《加州消费者隐私法》辩护。在全国范围内，我们帮助社区站起来并通过了禁止警察使用面部识别的禁令。</p>
<blockquote>
<p>  Every time, you were right there with us. Thousands of you wrote and called your lawmakers to explain to them why you need free speech and privacy online. And they listened. Some of this year’s most important victories didn’t come down to dramatic final votes. They came when experts like us explained to decisionmakers how an idea would harm online speech and privacy, and that idea was quietly backburnered.</p>
</blockquote>
<p>每次，您都和我们在一起。成千上万的你们写信并打电话给国会议员，向他们表达为什么需要网络言论自由和隐私权。他们留心听了。今年一些最重要的胜利并没有获得戏剧性的最终投票。当我们这样的专家向决策者们解释一个想法如何损害在线言论和隐私时，他们就来了，这个想法被悄悄地推倒了。</p>
<blockquote>
<p>  It’s not enough to defend digital rights in the courts and in Congress. That’s why EFF redoubled our efforts to hard code privacy principles into the Internet itself. We released Version 1.0 of Certbot, our tool that has helped over 2 million users maintain HTTPS access to over 20 million websites. We led the charge to champion the development of DNS over HTTPS, the next step in building a truly encrypted web. We also raised alarms about Amazon Ring’s insidious partnerships with law enforcement agencies, as well about the serious security issues with Ring and other Internet-connected cameras both inside and outside of our homes. In the final days of the year, we rallied over 500 .orgs to defend, well, .ORG.</p>
</blockquote>
<p>仅在法院和国会捍卫数字版权是不够的。这就是EFF加倍努力将硬性隐私原则硬编码到Internet本身的原因。我们发布了Certbot 1.0版，该工具已帮助超过200万用户维护了对超过2000万个网站的HTTPS访问。我们负责领导通过HTTPS进行DNS的开发，这是构建真正加密的Web的下一步。我们还对Amazon Ring与执法机构的阴险合作伙伴关系，以及与Ring以及我们房屋内外的其他联网摄像头的严重安全问题发出了警报。在一年的最后几天，我们召集了500多个.org来捍卫.ORG。</p>
<blockquote>
<p>  None of this would have been possible without you. Thanks to each and every one of you for standing on the side of digital civil liberties. Thanks for calling your members of Congress, demanding better policies from the tech companies you rely on, and even helping your relatives install Privacy Badger. Together, we’re building a digital future that serves everyone, not just the most powerful.</p>
</blockquote>
<p>没有您，这一切都是不可能的。感谢你们每一个人站在数字公民自由方面。感谢您致电国会议员，要求您依赖的科技公司制定更好的政策，甚至帮助您的亲戚安装Privacy Badger。我们将共同打造一个数字化的未来，为所有人服务，而不仅仅是最强大的人。</p>
<blockquote>
<p>  In the coming weeks, EFF’s banner case <em>Jewel v. NSA</em> will move to its next step, the Ninth Circuit Court of Appeals. In <em>Jewel</em>, we challenge the NSA’s mass surveillance practices. We believe that mass surveillance is illegal, unconstitutional, and wrong, and will never stop fighting it.</p>
</blockquote>
<p>在接下来的几周内，EFF的标志性案件Jewel v。NSA将移至下一步，即第九巡回上诉法院。在Jewel中，我们挑战了NSA的大规模监视做法。我们认为，大规模监视是非法的，违宪的和错误的，并且永远不会停止与之对抗。</p>
<blockquote>
<p>  Please consider joining EFF. Our fights are long—often years or even decades—and they require a long-term investment.</p>
</blockquote>
<p>请考虑加入EFF。我们的斗争是漫长的-通常是几年甚至几十年-并且它们需要长期的投资。</p>
<p><a href="https://supporters.eff.org/donate/YEDL--19" target="_blank" rel="noopener">DONATE TO EFF</a>  SUPPORT EFF</p>
<blockquote>
<p>  EFF has an annual tradition of writing several blog posts on what we’ve accomplished this year, what we’ve learned, and where we have more to do. We will update this page with new stories about digital rights in 2019 every day between now and New Year’s Day.</p>
</blockquote>
<p>EFF的传统是每年写几篇博客文章，介绍我们今年的成就，学到的知识以及需要做的事情。从现在到元旦之间，我们每天都会在2019年每天更新有关数字版权的新故事。</p>
<h3 id="2019-Retrospective-Blog-Posts"><a href="#2019-Retrospective-Blog-Posts" class="headerlink" title="2019 Retrospective Blog Posts"></a><strong>2019 Retrospective Blog Posts</strong></h3><ul>
<li><a href="https://www.eff.org/deeplinks/2019/12/year-we-fought-get-net-neutrality-back-2019-year-review" target="_blank" rel="noopener">The Year We Fought to Get Net Neutrality Back</a></li>
<li><a href="https://www.eff.org/deeplinks/2019/12/2019-end-year-review-smart-home-tech-police-and-your-privacy" target="_blank" rel="noopener">Smart Home Tech, Police, and Your Privacy</a></li>
</ul>
      </div>
    </div>
  <ul class="breadcrumb">
            <li><a href="/source/">SOURCE</a></li>
            <li><a href="/source/draft/">DRAFT</a></li>
            <li>2019-12-30-EFF-2019-REVIEW</li>
  </ul>
  </div>
          </div>
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>
        </div>
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/">
              <img class="site-author-image" itemprop="image" src="/avatar.png" alt="木子">
             </a>   
              <p class="site-author-name" itemprop="name">木子</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
            <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/muzi502" title="GitHub &rarr; https://github.com/muzi502" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:blog@502.li" title="E-Mail &rarr; mailto:blog@502.li" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://twitter.com/muzi_ii" title="Twitter &rarr; https://twitter.com/muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://t.me/muzi_ii" title="Telegram &rarr; https://t.me/muzi_ii" rel="noopener" target="_blank"><i class="fa fa-fw fa-telegram"></i></a>
                </span>
            </div>
             <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-Hans" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#TLD-DR"><span class="nav-number">1.</span> <span class="nav-text">TLD:DR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原文"><span class="nav-number">2.</span> <span class="nav-text">原文</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#翻译"><span class="nav-number">3.</span> <span class="nav-text">翻译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2019-Retrospective-Blog-Posts"><span class="nav-number">3.1.</span> <span class="nav-text">2019 Retrospective Blog Posts</span></a></li></ol></li></ol></div>
          </div>
        </div>
      <!--/noindex-->
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
            <span id="scrollpercent"><span>0</span>%</span>
        </div>
    </div>
  </aside>
      </div>
    </main>
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">木子</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div>
      </div>
    </footer>
  </div>
<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
  <script src="/lib/jquery/index.js?v=2.1.3"></script>
  <script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  <script src="/js/utils.js?v=7.1.0"></script>
  <script src="/js/motion.js?v=7.1.0"></script>
  <script src="/js/affix.js?v=7.1.0"></script>
  <script src="/js/schemes/pisces.js?v=7.1.0"></script>
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>
  <script src="/js/next-boot.js?v=7.1.0"></script>
  <script id="dsq-count-scr" src="https://muzi.disqus.com/count.js" async></script>
<script>
  var disqus_config = function() {
    this.page.url = "https://blog.502.li/source/draft/2019-12-30-eff-2019-review.html";
    this.page.identifier = "source/draft/2019-12-30-eff-2019-review.html";
    this.page.title = '电子前哨基金会 2019 年回顾';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://muzi.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
    $(function() {
      var offsetTop = $('#comments').offset().top - $(window).height();
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        loadComments();
      } else {
        $(window).on('scroll.disqus_scroll', function() {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = $('#comments').offset().top - $(window).height();
          var scrollTop = $(window).scrollTop();
          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            $(window).off('.disqus_scroll');
            loadComments();
          }
        });
      }
    });
</script>
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }
    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');
      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }
                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }
                // show search results
                if (isMatch) {
                  // sort index by position of keyword
                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });
                  // merge hits into slices
                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;
                      // move to next position of hit
                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }
                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }
                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }
                  // sort slices in content by search text's count and hits' count
                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });
                  // select top N slices in content
                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }
                  // highlight title and content
                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }
                  var resultItem = '';
                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }
                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });
                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }
          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }
          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');
          proceedsearch();
        }
      });
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>
</body>
</html>
